<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Gerenciador de Solicitações de Arte</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<!-- Firebase SDKs v9 Modular -->
<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        window.firebaseApp = initializeApp;
    </script>
<script type="module">
        import { getFirestore, collection, doc, onSnapshot, addDoc, updateDoc, deleteDoc, serverTimestamp, where, query, arrayUnion, arrayRemove, writeBatch, getDoc, orderBy } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
        window.firestore = { getFirestore, collection, doc, onSnapshot, addDoc, updateDoc, deleteDoc, serverTimestamp, where, query, arrayUnion, arrayRemove, writeBatch, getDoc, orderBy };
    </script>
<script type="module">
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        window.firebAuth = { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut, setPersistence, browserLocalPersistence };
    </script>
</head>
<body class="bg-gray-100">
<div id="root"></div>
<script type="text/babel">
async function handleUpload(file) {
    const formData = new FormData();
    formData.append("file", file);

    try {
        const response = await fetch("https://upload-api-641611102306.us-central1.run.app/upload", {
            method: "POST",
            body: formData
        });

        const result = await response.json();

        if (response.ok) {
            return result.gcs_url;
        } else {
            alert("Erro ao fazer upload: " + (result.error || "Erro desconhecido."));
            return null;
        }
    } catch (err) {
        console.error(err);
        alert("Falha ao conectar com o servidor.");
        return null;
    }
}
</script>
<script>
  async function uploadImage(file) {
    const formData = new FormData();
    formData.append("file", file);

    const tokenRes = await fetch("/token");
    const { token } = await tokenRes.json();

    const uploadRes = await fetch("https://upload-api-xxxxxxxx.a.run.app/upload", {
      method: "POST",
      headers: {
        Authorization: `Bearer ${token}`
      },
      body: formData
    });

    if (!uploadRes.ok) {
      alert("Erro ao enviar imagem");
      return null;
    }

    return "ENVIADO COM SUCESSO"; // ou pode retornar a URL pública se for o caso
  }
</script>
</body>
</html>
